{% extends "quiz_for_brandpol/base.html" %}
{% block title %}Вопрос {{ index }} из {{ total }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h5 mb-0">{{ question.test.title }}</h1>
  <span class="text-muted">Вопрос {{ index }} из {{ total }}</span>
</div>

<div class="progress mb-3" style="height: 10px;">
  <div class="progress-bar" role="progressbar"
       style="width: {{ percent }}%;"
       aria-valuenow="{{ percent }}" aria-valuemin="0" aria-valuemax="100">
  </div>
</div>

<div class="card shadow-sm">
  <div class="card-body">
    <h2 class="h5 mb-3">{{ question.text }}</h2>

    <form id="q-form" method="post" class="mt-3">
      {% csrf_token %}

      <div class="vstack gap-2">
        {% for a in question.answers.all %}
          <div class="form-check">
            <input class="form-check-input answer-check" type="checkbox" name="answers" id="a{{ a.id }}" value="{{ a.id }}">
            <label class="form-check-label" for="a{{ a.id }}">{{ a.text }}</label>
          </div>
        {% endfor %}
      </div>

      <div id="validation-msg" class="text-danger mt-2 d-none">Выберите хотя бы один вариант.</div>

      <div class="d-flex gap-2 mt-4">
        {% if prev_id %}
          <a class="btn btn-outline-secondary" href="{% url 'qfb_question' attempt_id=attempt.id question_id=prev_id %}">← Назад</a>
        {% endif %}
        <button type="submit" name="skip" class="btn btn-outline-warning">Пропустить</button>
        {% if next_id %}
          <button type="submit" id="save-next" class="btn btn-primary">Сохранить и далее →</button>
        {% else %}
          <button type="submit" id="finish" name="finish" class="btn btn-success">Завершить тест</button>
        {% endif %}
      </div>
    </form>
  </div>
</div>

<script>
  (function(){
    const msg  = document.getElementById('validation-msg');
    function hasChecked() {
      return Array.from(document.querySelectorAll('.answer-check')).some(i => i.checked);
    }
    function validate(e){
      if (!hasChecked()) { e.preventDefault(); msg.classList.remove('d-none'); }
    }
    const nextBtn = document.getElementById('save-next');
    const finishBtn = document.getElementById('finish');
    if (nextBtn) nextBtn.addEventListener('click', validate);
    if (finishBtn) finishBtn.addEventListener('click', validate);
  })();
</script>
{% endblock %}
